<!DOCTYPE html>
<html>
<<<<<<< HEAD
  <head>
    <title>MC Watson</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="stylesheets/style.css">
  </head>
  <body>
    <div class="mainbox">
      <table class="indextable">
        <tr>
          <td colspan="2">
            <h1 style="text-align: center" id="message">MC Watson</h1>
          </td>
        </tr>
        <tr>
          <td style= "width:25%;">
            <img class = "appIcon" src="images/app-icon.png">
          </td>
          <td>
            <h3> Don't you know what to Eat? </h3>
            <h3> "My Chef Watson" will tell you what you want. </h3>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <h2> Eat! Enjoy! with Watson! </h2>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <div class="enterbox">
              <h2 style="text-align: center"><a href="main.html">Start Now!</a></h1>
            </div>
          </td>
        </tr>
      </table>
    </div>
  </body>
=======
	<head>
		<title>NodeJS Starter Application</title>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="stylesheets/style.css">
	</head>
	<body>
		<div>
			<h1>Convesation API test page</h1>
			<form>
				Input Sentence:<t><input type="text" name="input_sentence" id="input_sentence" size="50"/><br>
				Answer Sentence:<t><input type="text" name="answer" id="answer" size="50"/><br>
				<input type="button" name="execute" id="execute" value="make_answer" onclick="getAnswer()"/>
			</form>
		</div>
		<div>
			<div id="food_0" style="float: left; margin: 3px; padding: 10px"></div>
			<div id="food_1" style="float: left; margin: 3px; padding: 10px"></div>
			<div id="food_2" style="float: left; margin: 3px; padding: 10px"></div>
			<div id="food_3" style="float: left; margin: 3px; padding: 10px"></div>
		</div>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
		<script>
			var context = {},	// save context came from conversation api
				output = "",	// the answer watson will say
				category,		// what category of food
				target = [],	// save json file at here
				foods = [],		// where a list of foods will be saved
				iterator = 0,	// iterator for print examples
				allFoods = [];

			// function prints 4 examples of foods
			var printExamples = function() {
				var j, singleFood;
				for (j = 0; j < 4; iterator++, j++) {
					if (iterator === 30) {
						alert('no more foods');
						break;
					} // when reach last food, stop iterating and printing
					singleFood = foods[iterator];

					var htmlString = "<img src='" + singleFood.image + "' alt='" + singleFood.name + "' width='30'/>" + 
									 "<div id='name_" + j + "'><b>" + singleFood.name + "</div>";
					if (singleFood.hasOwnProperty('nutrition')) {
						htmlString += "<div id='calories_" + j + "'>" + singleFood.nutrition.calories + " kcal</div>";
					}

					// print food list
					$("#food_" + j).html(htmlString);
				}
			}

			// get data based on entities and category
			var getData = function(entity) {
				// get json file
				$.ajax({
					dataType: "json",
					async: false,
					url: "/jsondata/" + entity + "_" + category + "_30_revised.json",
					success: function(data) {
						console.log(data);
						target = data.foods;
						console.log(target);
					}
				});
				var j,			// iterator for array of objects about recipe
					i = -1;		// iterator for food array
				for (j in target) {
					if (!target[j].hasOwnProperty('nutrition')) continue;
					var initialNut = target[j].nutrition,
						calories = initialNut[0].split(" "),
						fat = initialNut[1].split(" "),
						carbohydrate = initialNut[2].split(" "),
						protein = initialNut[3].split(" "),
						cholesterol = initialNut[4].split(" "),
						sodium = initialNut[5].split(" ");
					var nutritionObj = {
						'calories': calories[1],
						'fat': fat[1],
						'carbohydrate': carbohydrate[1].substring(0, carbohydrate[1].length - 1),
						'protein': protein[1],
						'cholesterol': cholesterol[1],
						'sodium': sodium[1]
					};
					target[j].nutrition = nutritionObj;
				}
				foods = target;
			}

			// based on context, detemine data to get
			var afterGetContext = function() {
				iterator = 0;
				foods = [];
				if (context.hasOwnProperty('health')) {
					console.log(context['health'] + ' is came for input.');
					category = context.health;
					getData('healthy');
					delete context.health;
				} else if (context.hasOwnProperty('events')) {
					console.log(context.events + ' is came for input.');
					category = context.events;
					getData('events');
					delete context.events;			
				} else if (context.hasOwnProperty('time')) {
					console.log(context.time + ' is came for input.');
					category = context.time;
					getData('timeslot');
					delete context.time;
				}
				printExamples();
			}

			// execute when button clicked
			var getAnswer = function() {
				$.ajax({
					url: "http://nwparadises.mybluemix.net/test",
					type: "post",
					contentType: "application/x-www-form-urlencoded",
					dataType: "text",
					data: {
						input_sentence: $("#input_sentence").val(),
						cur_context: JSON.stringify(context)
					},
					success: function (data) {
						var parsedData = JSON.parse(data);
						context = parsedData.context;		// context passed by watson
						allFoods = context.allFoods;
						console.log(context.allFoods);
						context.allFoods = true;
						output = parsedData.output.text[0];	// watson answer
						$("#answer").val(output);
						if (context.hasOwnProperty('next') && context.next === true) {
							printExamples();
							delete context.next;
							console.log(context);
						} else {
							afterGetContext();
						}
					}
				});
			}
			getAnswer();
		</script>
	</body>
>>>>>>> refs/remotes/nparadise/master
</html>